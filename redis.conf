# ===== Redis 영속성 설정 =====

# RDB 스냅샷 저장 조건 (Default)
save 900 1
save 300 10
save 60 10000

# RDB 설정
# RDB 파일명
dbfilename dump.rdb
# RDB 파일 압축 활성화 (디스크 절약)
rdbcompression yes
# 파일 무결성 체크섬 활성화 (손상 감지)
rdbchecksum yes
# RDB 저장 실패 시에도 쓰기 작업 계속 (가용성 우선)
stop-writes-on-bgsave-error no

# AOF 설정
# AOF 활성화
appendonly yes
# AOF 파일명
appendfilename "appendonly.aof"
# 매초마다 디스크에 fsync (최대 1초 데이터 손실)
appendfsync everysec
# AOF 파일이 이전 크기의 2배가 되면 재작성
auto-aof-rewrite-percentage 100
# AOF 재작성 최소 크기 (64MB 이상일 때만)
auto-aof-rewrite-min-size 64mb
# 손상된 AOF 끝부분 무시하고 로드 (빠른 복구)
aof-load-truncated yes

# 데이터 디렉토리
# RDB/AOF 파일 저장 경로
dir /data

# 메모리 설정
# 최대 메모리 사용량 제한
maxmemory 512mb
# 메모리 부족 시 가장 오래 사용 안 한 키 삭제
maxmemory-policy allkeys-lru